<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtro de Letras Negras con OpenCV.js</title>
    <script async src="https://docs.opencv.org/4.x/opencv.js" type="text/javascript"></script>
</head>
<body>
    <h1>Detectar y Dejar Solo Letras Negras</h1>
    <input type="file" id="fileInput" accept="image/*" />
    <canvas id="canvasOutput"></canvas>

    <script>
        // Esperar a que OpenCV.js esté listo
        function onOpenCvReady() {
            document.getElementById('fileInput').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) {
                    alert("Por favor selecciona una imagen.");
                    return;
                }

                const imgElement = new Image();
                imgElement.onload = () => processImage(imgElement);
                imgElement.src = URL.createObjectURL(file);
            });
        }

        function processImage(image) {
            // Crear matriz OpenCV desde la imagen
            let src = cv.imread(image);
            let gray = new cv.Mat();
            let binary = new cv.Mat();

            // Convertir a escala de grises
            cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);

            // Aplicar un umbral binario inverso para detectar áreas oscuras
            // Ajustar el valor 50 según las necesidades para definir "oscuro"
            cv.threshold(gray, binary, 50, 255, cv.THRESH_BINARY_INV);

            // Mostrar el resultado en el canvas
            let rgba = new cv.Mat();
            cv.cvtColor(binary, rgba, cv.COLOR_GRAY2RGBA, 0);

            // Eliminar colores no negros (hacer transparente lo demás)
            for (let i = 0; i < rgba.rows; i++) {
                for (let j = 0; j < rgba.cols; j++) {
                    let pixel = rgba.ucharPtr(i, j);
                    if (pixel[0] === 0 && pixel[1] === 0 && pixel[2] === 0) {
                        // Mantener negro
                        pixel[3] = 255; // Alpha a opaco
                    } else {
                        // Hacer transparente
                        pixel[3] = 0;
                    }
                }
            }

            // Mostrar la imagen procesada en el canvas
            cv.imshow('canvasOutput', rgba);

            // Liberar recursos
            src.delete();
            gray.delete();
            binary.delete();
            rgba.delete();
        }
    </script>
</body>
</html>
