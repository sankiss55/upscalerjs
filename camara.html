<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixi.js: Detectar Letras Negras</title>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8.x/dist/pixi.min.js"></script>
</head>
<body>
    <h1>Detectar Letras Negras con Pixi.js</h1>
    <input type="file" id="upload" accept="image/*">
    <div id="app"></div>

    <script>
        // Crear la aplicación Pixi.js
        const app = new PIXI.Application({
            width: 800,
            height: 600,
            backgroundColor: 0xffffff,
        });

        // Obtener el contenedor donde se añadirá el canvas
        const appContainer = document.getElementById("app");
        if (appContainer) {
            appContainer.appendChild(app.view);
        } else {
            console.error("No se pudo encontrar el contenedor con id 'app'.");
        }

        // Manejar la subida de una imagen
        const uploadInput = document.getElementById("upload");
        uploadInput.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) {
                alert("Por favor, selecciona un archivo de imagen válido.");
                return;
            }

            const imgURL = URL.createObjectURL(file);
            processImage(imgURL);
        });

        function processImage(imageURL) {
            try {
                // Limpiar el escenario antes de agregar nuevos elementos
                app.stage.removeChildren();

                // Cargar la textura de la imagen
                const texture = PIXI.Texture.from(imageURL);

                texture.baseTexture.on('loaded', () => {
                    const sprite = new PIXI.Sprite(texture);

                    // Configurar el sprite
                    sprite.x = 0;
                    sprite.y = 0;
                    sprite.width = app.renderer.width;
                    sprite.height = app.renderer.height;

                    // Agregar sprite al escenario
                    app.stage.addChild(sprite);

                    // Crear un filtro para detectar letras negras
                    const blackFilter = new PIXI.Filter(null, `
                        precision mediump float;
                        varying vec2 vTextureCoord;
                        uniform sampler2D uSampler;

                        void main() {
                            vec4 color = texture2D(uSampler, vTextureCoord);
                            float luminance = (color.r + color.g + color.b) / 3.0;

                            // Detectar píxeles oscuros (negros)
                            if (luminance < 0.2) {
                                gl_FragColor = color; // Mantener negro
                            } else {
                                gl_FragColor = vec4(1.0, 1.0, 1.0, 0.0); // Transparente
                            }
                        }
                    `);

                    // Aplicar el filtro
                    sprite.filters = [blackFilter];
                    console.log("Imagen procesada correctamente.");
                });

            } catch (error) {
                alert("Error al procesar la imagen: " + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
